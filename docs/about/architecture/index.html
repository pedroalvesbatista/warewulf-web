<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Warewulf Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Warewulf Blog Atom Feed"><title data-react-helmet="true">Architecture | Warewulf</title><meta data-react-helmet="true" property="og:url" content="https://warewulf.hpcng.org/docs/about/architecture"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Architecture | Warewulf"><meta data-react-helmet="true" name="description" content="Warewulf&#x27;s primary design goal is to facilitate software installation, configuration and management on the most common architecture for an HPC cluster nowadays. This popular cluster design originated 25 years ago with the seminal commodity-off-the-shelf (COTS) architecture commonly known as the &quot;Beowulf&quot;."><meta data-react-helmet="true" property="og:description" content="Warewulf&#x27;s primary design goal is to facilitate software installation, configuration and management on the most common architecture for an HPC cluster nowadays. This popular cluster design originated 25 years ago with the seminal commodity-off-the-shelf (COTS) architecture commonly known as the &quot;Beowulf&quot;."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://warewulf.hpcng.org/docs/about/architecture"><link data-react-helmet="true" rel="alternate" href="https://warewulf.hpcng.org/docs/about/architecture" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://warewulf.hpcng.org/docs/about/architecture" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.edc18148.css">
<link rel="preload" href="/assets/js/runtime~main.a5f42eed.js" as="script">
<link rel="preload" href="/assets/js/main.e1a2afc8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Warewulf Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Warewulf Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Warewulf</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/news">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hpcng/warewulf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">About</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/about/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/about/security">Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/about/templating">Templating</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Prerequisites</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Quickstart Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">wwctl</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contributing</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Appendix</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Architecture</h1></header><p>Warewulf&#x27;s primary design goal is to facilitate software installation, configuration and management on the most common architecture for an HPC cluster nowadays. This popular cluster design originated 25 years ago with the seminal commodity-off-the-shelf (COTS) architecture commonly known as the &quot;Beowulf&quot;.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-beowulf"></a>The Beowulf<a class="hash-link" href="#the-beowulf" title="Direct link to heading">#</a></h2><p>The original <a href="https://en.wikipedia.org/wiki/Beowulf_cluster" target="_blank" rel="noopener noreferrer">Beowulf Cluster</a> was developed in 1996 by Dr. Thomas Sterling and Dr. Donald Becker at NASA. The architecture is defined as a group of similar compute worker nodes all connected together using standard commodity equipment on a private network segment. The control node is dual homed (has two network interface cards) with one of these network interface cards attached to the upstream network and the other connected to the same private network which connects the compute worker nodes (as seen in the figure below).</p><p>.. image:: /images/beowulf_architecture.png</p><p>This simple topology is good for creating a scalable HPC cluster resource. To create a working cluster, storage, scheduling and resource management, monitoring, interactive systems, need to be added. Moreover, as the system grows, it may need to have groups of nodes with different features, architectures, vintages, memory configurations, GPUs or interconnects, etc. As the system grows more complex, the need for a scalable control surface also increases.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="provisioning"></a>Provisioning<a class="hash-link" href="#provisioning" title="Direct link to heading">#</a></h2><p>Warewulf is designed to support the simplest of clusters, but also the most complicated, largest, and specialized resources that are in demand today. But when implementing all the various configurations, we rely on the basic architecture illustrated above. We can rely on such a simple schematic because Warewulf is designed to &quot;own&quot; the network broadcast domain for the private network and manage how these worker nodes boot.</p><p>As mentioned before, Warewulf is designed first and foremost to be a stateless provisioning subsystem. This means that the worker nodes, also known as compute nodes, maintain no state about their configuration, operating system or purpose when they are powered off. The advantages of stateless is that the nodes can be easily and quickly provisioned into any needed confguration (personality), there is no worry about the configuration of an existing compute node so there is no OS versioning problems, and the compute nodes will always have the latest and greatest OS image. While not explicitly mentioned, stateless nodes do not have to have an internal drive with the OS being stored on a RAM file system (initramfs), reducing the cost and complexity. However, an internal drive can be used for local storage but no OS installation. For these reasons, the worker nodes will need to boot via <a href="https://en.wikipedia.org/wiki/Preboot_Execution_Environment" target="_blank" rel="noopener noreferrer">PXE</a> to retrieve a personality and a purpose.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pxe"></a>PXE<a class="hash-link" href="#pxe" title="Direct link to heading">#</a></h2><p>Most servers will have network interface cards that support PXE by default. In a nutshell, PXE will allow the network card to be seen by the BIOS as a bootable device. This means that the boot order on the worker nodes may need to be configured in the system&#x27;s BIOS to allow it to boot. If there is also another bootable device on these systems, it might be necessary to set the network interface card to boot first.</p><p>When the system boots via PXE, it will begin a chain reaction of events:</p><ol><li>The network card will register an option ROM into the BIOS</li><li>The BIOS will run through all of its functions and finish with boot devices</li><li>The boot devices are attempted to be booted in the defined order</li><li>When it gets to the network boot device, PXE is run from the firmware on the network card</li><li>PXE will request a BOOTP/DHCP address on the network which is handled by the controller node</li><li>If the DHCP response includes a boot file name, it will download this file (iPXE boot image) over TFTP</li><li>Once iPXE is downloaded, it is loaded by the network card and it will request a configuration from the
controller node</li><li>The configuration will tell iPXE what to download and load</li></ol><p>Warewulf manages the entire process once the worker node&#x27;s network device has begun the PXE process.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="warewulf-server"></a>Warewulf Server<a class="hash-link" href="#warewulf-server" title="Direct link to heading">#</a></h2><p>Warewulf will configure the DHCP and TFTP services of the cluster head node (also referred to as a &quot;control node&quot;) and put all the required files into place. But once the iPXE file has been sent and loaded on the worker nodes, all network communication from this point on is handled by the Warewulf server on the controller node over HTTP. The order of events from this point on is as follows:</p><ol><li>iPXE requests its configuration and Warewulf generates this on demand from the configured template</li><li>The default iPXE template tells iPXE to request a kernel, VNFS image, runtime kernel modules and a system overlay</li><li>Each of the requested files will be sent to the worker node</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="post-pxe"></a>Post PXE<a class="hash-link" href="#post-pxe" title="Direct link to heading">#</a></h2><p>Once the worker node has received all the required files, the kernel will boot, and the runtime components will be loaded into the kernel&#x27;s initial RAM file system (initramfs). The order of these processes is important because each layer is dependent on the previous. The layers are implemented in the following order:</p><ol><li>VNFS/Container image</li><li>Kernel modules</li><li>System Overlay</li><li>Runtime Overlay</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The Runtime Overlay may be resent to the worker node in the future or at regular intervals.</p></div></div><p>As part of the provisioning process, the system boots after the System Overlay has been provisioned, which means that the Runtime Overlay occurs after <code>/sbin/init</code> has been called on the system. This delineation is important because it clearly defines what should be in the system versus runtime overlay. More on overlays in the next section.</p><p>Before calling <code>/sbin/init</code> (or <code>init</code> to override in the node configuration file), Warewulf must set up the system. Again, this process occurs after the System Overlay has been provisioned. This is where the system initializes and prepares for booting the runtime OS. Depending on the configuration, the system might boot directly in the initramfs file system as it stands, or it could migrate the root file system to a different mount point (e.g. <code>tmpfs</code>or at some point, hard drives).</p><p>Other things that get done at this stage are setting up and enabling SELinux, IPMI, making any needed changes or configurations to the file system before booting it and starting up the <code>wwclient</code> which is responsible for loading the runtime overlay.</p><p>Lastly, the <code>init</code> process is executed with PID 1 and thus &quot;boots&quot; the VNFS container. This is where SysVInit, Upstart, or Systemd takes over.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="warewulf-overlays"></a>Warewulf Overlays<a class="hash-link" href="#warewulf-overlays" title="Direct link to heading">#</a></h2><p>As described above, Warewulf uses <em>layers</em> to provision worker nodes in phases. The first layer is static across any number of nodes, but each node may require some custom configurations. The most common example is the network configuration that should be differnt for each node since node has its own IP address. This means there must be a method for leveraging a base file system (VNFS) that can be shared by many nodes and also be able to configure these file systems with custom per-node options at a large scale.</p><p>Typically, there are two major times this configuration needs to be done-- pre &quot;boot&quot; and post &quot;boot&quot;. In this case, as described above, we can consider the call to <code>/sbin/init</code> the delineation point and the proper way to consider the two configurable overlays: system and runtime.</p><p><strong>System Overlay</strong>: The system overlay is what will be present before <code>/sbin/init</code> is called. This gives the administrator the ability to control the configuration of the booting system itself. For example, network configuration must be addressed on every node, but each node must have a slightly different network configuration otherwise the IP addresses will clash. This must be set before Systemd brings up the network device, so the Warewulf system overlay is the right place to configure this.</p><p><strong>Runtime Overlays</strong>: Some configurations happen after the system boots and continuously at periodic intervals. An example of a periodic update are user and group accounts. You probably don&#x27;t want to reprovision a node, let alone hundreds of nodes, to add a user or change a runtime configuration, and this is where you should use the runtime overlay.</p><p>Both overlays leverage a similar file system template structure. Each overlay (you can create any number of them) can include text files, directories, links and templates. Templates allow you to dynamically customize any of the content within an overlay for each node that will be leveraging that template.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/hpcng/warewulf-web/edit/main/docs/about/architecture.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/about/security"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-beowulf" class="table-of-contents__link">The Beowulf</a></li><li><a href="#provisioning" class="table-of-contents__link">Provisioning</a></li><li><a href="#pxe" class="table-of-contents__link">PXE</a></li><li><a href="#warewulf-server" class="table-of-contents__link">Warewulf Server</a></li><li><a href="#post-pxe" class="table-of-contents__link">Post PXE</a></li><li><a href="#warewulf-overlays" class="table-of-contents__link">Warewulf Overlays</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/hpcng/shared_invite/zt-ll5c3ofb-XhvMPbXUhTVrHlutQz2jbA" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCQbKq1vIffqRAMUDPfHcU0w" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">News</a></li><li class="footer__item"><a href="https://github.com/hpcng/warewulf" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 HPCng. - All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a5f42eed.js"></script>
<script src="/assets/js/main.e1a2afc8.js"></script>
</body>
</html>